---
phase: 03-customer-article-and-order-resources
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - nodes/Fortnox/OrderDescription.ts
autonomous: true
requirements:
  - ORD-01
  - ORD-02
  - ORD-03
  - ORD-04
  - ORD-05
  - ORD-06

must_haves:
  truths:
    - "OrderDescription.ts exports orderOperations and orderFields arrays"
    - "Order operations include create, get, getMany, update, cancel, createInvoice"
    - "Order create has CustomerNumber as required top-level field"
    - "Order create has OrderRows fixedCollection with OrderedQuantity and DeliveredQuantity fields"
    - "Order getMany has Return All toggle, Limit, and Filters with order-specific filters (cancelled, expired, invoicecreated, invoicenotcreated)"
    - "Order getMany Filters include fromdate, todate, lastmodified, sortby (customername/customernumber/documentnumber/orderdate), sortorder"
    - "commonOrderFields shared array used by both Additional Fields and Update Fields"
    - "Cancel and Create Invoice operations only require DocumentNumber (no additional parameters)"
  artifacts:
    - path: "nodes/Fortnox/OrderDescription.ts"
      provides: "Order resource operations and field definitions with OrderRows"
      exports: ["orderOperations", "orderFields"]
  key_links:
    - from: "nodes/Fortnox/OrderDescription.ts"
      to: "n8n-workflow INodeProperties"
      via: "type import"
      pattern: "import type.*INodeProperties.*from 'n8n-workflow'"
---

<objective>
Create OrderDescription.ts with full field coverage including OrderRows (line items), cancel action, and order-to-invoice conversion. This is the most complex of the three resources due to OrderRows fixedCollection and action endpoints.

Purpose: Orders complete the four-resource set (Invoice, Customer, Article, Order) needed for end-to-end accounting automation. The order-to-invoice conversion enables the complete sales workflow.

Output: Complete OrderDescription.ts ready for wiring into Fortnox.node.ts in Plan 03.
</objective>

<execution_context>
@/Users/adamnoren/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adamnoren/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@nodes/Fortnox/InvoiceDescription.ts

<interfaces>
<!-- The executor must follow InvoiceDescription.ts patterns exactly, especially for fixedCollection rows. Key patterns: -->

From nodes/Fortnox/InvoiceDescription.ts:
```typescript
// Row fields: reusable array for fixedCollection values
const invoiceRowFields: INodeProperties[] = [
    { displayName: 'Article Number', name: 'ArticleNumber', type: 'string', default: '' },
    { displayName: 'Account Number', name: 'AccountNumber', type: 'number', default: 0 },
    { displayName: 'Delivered Quantity', name: 'DeliveredQuantity', type: 'number', default: 1 },
    { displayName: 'Description', name: 'Description', type: 'string', default: '' },
    { displayName: 'Price', name: 'Price', type: 'number', default: 0 },
];

// fixedCollection for rows:
{
    displayName: 'Invoice Rows',
    name: 'invoiceRows',
    type: 'fixedCollection',
    typeOptions: { multipleValues: true },
    displayOptions: { show: { resource: ['invoice'], operation: ['create'] } },
    default: {},
    description: 'Line items for the invoice...',
    options: [
        { displayName: 'Row', name: 'row', values: invoiceRowFields },
    ],
}

// Update Fields includes rows as nested fixedCollection:
{
    displayName: 'Update Fields',
    name: 'updateFields',
    type: 'collection',
    options: [
        ...commonInvoiceFields,
        {
            displayName: 'Invoice Rows',
            name: 'InvoiceRows',
            type: 'fixedCollection',
            typeOptions: { multipleValues: true },
            default: {},
            options: [
                { displayName: 'Row', name: 'row', values: invoiceRowFields },
            ],
        },
    ],
}
```

Key conventions:
- Title Case for all displayName values
- Options type fields default to valid option value (not empty string)
- Filters alphabetized by displayName
- commonFields shared between Additional Fields and Update Fields
- Action operations (cancel, createInvoice) only need DocumentNumber -- no additional parameters
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OrderDescription.ts with operations, OrderRows, and full field coverage</name>
  <files>nodes/Fortnox/OrderDescription.ts</files>
  <action>
Create `nodes/Fortnox/OrderDescription.ts` following the exact InvoiceDescription.ts pattern but with Order-specific operations and fields.

**Exports:** `orderOperations` and `orderFields`

**orderOperations:** Operation dropdown with displayOptions `{ show: { resource: ['order'] } }`:
- Cancel (value: 'cancel', action: 'Cancel an order', description: 'Cancel an order')
- Create (value: 'create', action: 'Create an order', description: 'Create a new sales order')
- Create Invoice (value: 'createInvoice', action: 'Create invoice from order', description: 'Convert an order to an invoice')
- Get (value: 'get', action: 'Get an order', description: 'Retrieve an order by document number')
- Get Many (value: 'getMany', action: 'Get many orders', description: 'List orders with optional filters')
- Update (value: 'update', action: 'Update an order', description: 'Update an order')
- default: 'getMany'
- Alphabetized by name.

**orderRowFields array** (private, not exported -- used in fixedCollection):
Alphabetized by displayName. All writable Order row fields:
- Account Number (AccountNumber, number, default 0, 'Revenue account (required if no ArticleNumber)')
- Article Number (ArticleNumber, string, default '', 'Article from register')
- Cost Center (CostCenter, string, default '', 'Row cost center')
- Delivered Quantity (DeliveredQuantity, number, default 0, 'Quantity delivered')
- Description (Description, string, default '', 'Line item description')
- Discount (Discount, number, default 0, 'Discount value')
- Discount Type (DiscountType, options with AMOUNT/PERCENT, default 'PERCENT', 'Discount type')
- Housework (HouseWork, boolean, default false, 'ROT/RUT housework')
- Housework Hours To Report (HouseWorkHoursToReport, number, default 0, 'Hours for housework')
- Housework Type (HouseWorkType, string, default '', 'Housework type code')
- Ordered Quantity (OrderedQuantity, number, default 1, 'Quantity ordered')
- Price (Price, number, default 0, 'Unit price')
- Project (Project, string, default '', 'Row project code')
- Unit (Unit, string, default '', 'Unit of measure')
- VAT (VAT, number, default 0, 'VAT percentage')

Do NOT include read-only row fields: ContributionPercent, ContributionValue, Total.

**orderFields array structure:**

A. **DocumentNumber** (shared by get, update, cancel, createInvoice):
   - displayName: 'Document Number', name: 'documentNumber', type: 'string', required: true
   - displayOptions: show resource=['order'], operation=['get', 'update', 'cancel', 'createInvoice']
   - description: 'The order document number in Fortnox'

B. **CustomerNumber** (required for create):
   - displayName: 'Customer Number', name: 'customerNumber', type: 'string', required: true
   - displayOptions: show resource=['order'], operation=['create']
   - description: 'The customer number from Fortnox customer register'

C. **Order Rows** fixedCollection (create):
   - displayName: 'Order Rows', name: 'orderRows', type: 'fixedCollection'
   - typeOptions: { multipleValues: true }
   - displayOptions: show resource=['order'], operation=['create']
   - options: [{ displayName: 'Row', name: 'row', values: orderRowFields }]
   - description: 'Line items for the order. Each row requires either an ArticleNumber or an AccountNumber.'

D. **Return All** toggle (getMany):
   - Same pattern as Invoice

E. **Limit** (getMany when returnAll=false):
   - Same pattern as Invoice, default: 50, min: 1, max: 500

F. **Filters** collection (getMany) with these options (alphabetized by displayName):
   - Filter: options type with values: cancelled, expired, invoicecreated, invoicenotcreated. Default: 'cancelled'. Description: 'Filter orders by status'. NOTE: These are ORDER-specific filters -- completely different from Invoice filters.
   - From Date: name 'fromdate', type 'string', default '', description 'Return orders from this date (YYYY-MM-DD)'
   - Last Modified: name 'lastmodified', type 'string', default '', description 'Filter by last modified date (YYYY-MM-DD HH:MM)'
   - Sort By: options with values: customername, customernumber, documentnumber, orderdate. Default: 'documentnumber'. Description: 'Sort results by field'
   - Sort Order: options with ascending, descending. Default: 'ascending'
   - To Date: name 'todate', type 'string', default '', description 'Return orders up to this date (YYYY-MM-DD)'

G. **Additional Fields** collection (create) -- uses `commonOrderFields`:
   - displayOptions: show resource=['order'], operation=['create']
   - options: commonOrderFields

H. **Update Fields** collection (update) -- uses spread of commonOrderFields plus OrderRows:
   - displayOptions: show resource=['order'], operation=['update']
   - options: [
       ...commonOrderFields,
       { OrderRows fixedCollection using orderRowFields -- same pattern as Invoice update's InvoiceRows }
     ]

**commonOrderFields array** (alphabetized by displayName, all writable Order fields):

Include ALL of these fields:
- Administration Fee (AdministrationFee, number, 'Administration fee amount')
- Address Line 1 (Address1, string, 'Billing address line 1')
- Address Line 2 (Address2, string, 'Billing address line 2')
- City (City, string, 'Billing city')
- Comments (Comments, string, 'Order comments')
- Copy Remarks (CopyRemarks, boolean, 'Copy remarks to invoice')
- Cost Center (CostCenter, string, 'Cost center code')
- Country (Country, string, 'Billing country')
- Currency (Currency, string, 'Currency code (e.g., SEK)')
- Currency Rate (CurrencyRate, number, 'Exchange rate')
- Currency Unit (CurrencyUnit, number, 'Currency unit')
- Customer Name (CustomerName, string, 'Customer display name')
- Delivery Address Line 1 (DeliveryAddress1, string)
- Delivery Address Line 2 (DeliveryAddress2, string)
- Delivery City (DeliveryCity, string)
- Delivery Country (DeliveryCountry, string)
- Delivery Date (DeliveryDate, string, 'Delivery date (YYYY-MM-DD)')
- Delivery Name (DeliveryName, string, 'Delivery recipient name')
- Delivery Zip Code (DeliveryZipCode, string, 'Delivery postal code')
- External Invoice Reference 1 (ExternalInvoiceReference1, string)
- External Invoice Reference 2 (ExternalInvoiceReference2, string)
- Freight (Freight, number, 'Freight amount')
- Language (Language, options with SV/EN, default 'SV', 'Order language')
- Not Completed (NotCompleted, boolean, 'Whether order is not fully completed')
- Order Date (OrderDate, string, 'Order date (YYYY-MM-DD)')
- Our Reference (OurReference, string, 'Internal reference')
- Phone 1 (Phone1, string)
- Phone 2 (Phone2, string)
- Price List (PriceList, string, 'Price list code')
- Print Template (PrintTemplate, string, 'Print template name')
- Project (Project, string, 'Project code')
- Remarks (Remarks, string, 'Order remarks')
- Terms Of Delivery (TermsOfDelivery, string, 'Delivery terms code')
- Terms Of Payment (TermsOfPayment, string, 'Payment terms code')
- VAT Included (VATIncluded, boolean, 'Whether prices include VAT')
- Way Of Delivery (WayOfDelivery, string, 'Delivery method code')
- Your Order Number (YourOrderNumber, string, "Customer's order number")
- Your Reference (YourReference, string, "Customer's reference")
- Zip Code (ZipCode, string, 'Billing postal code')

Do NOT include read-only fields: AdministrationFeeVAT, BasisTaxReduction, Cancelled, ContributionPercent, ContributionValue, FreightVAT, Gross, HouseWork, InvoiceReference, Net, OfferReference, OrderType, OrganisationNumber, RoundOff, Sent, TaxReduction, Total, TotalToPay, TotalVAT, WarehouseReady.

All number fields: default 0. All string fields: default ''. All boolean fields: default false.
All options fields: default to first valid option value.
  </action>
  <verify>
    <automated>cd /Users/adamnoren/n8n-nodes-fortnox && npx tsc --noEmit nodes/Fortnox/OrderDescription.ts 2>&1 | head -20</automated>
  </verify>
  <done>
    - OrderDescription.ts exists with exported orderOperations and orderFields
    - 6 operations defined: cancel, create, createInvoice, get, getMany, update
    - orderRowFields array includes OrderedQuantity and DeliveredQuantity (Order-specific fields)
    - OrderRows fixedCollection used in both create (top-level) and update (inside Update Fields)
    - commonOrderFields shared array with all ~39 writable fields alphabetized
    - Filters collection has order-specific values: cancelled, expired, invoicecreated, invoicenotcreated (NOT invoice filter values)
    - Filters include fromdate, todate, lastmodified
    - Cancel and Create Invoice operations only need DocumentNumber
    - TypeScript compiles without errors
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors for OrderDescription.ts
- File follows InvoiceDescription.ts conventions: Title Case displayNames, alphabetized options, valid defaults
- Order has 6 operations (cancel, create, createInvoice, get, getMany, update)
- OrderRows fixedCollection mirrors InvoiceRows pattern but adds OrderedQuantity
- Order filters are distinct from Invoice filters (cancelled/expired/invoicecreated/invoicenotcreated vs fullypaid/unpaid/unbooked)
- Read-only fields excluded
</verification>

<success_criteria>
1. OrderDescription.ts compiles and exports orderOperations + orderFields
2. OrderRows fixedCollection present with all writable row fields including OrderedQuantity
3. Cancel and createInvoice operations require only DocumentNumber
4. Filters use order-specific values (not copied from Invoice)
5. Full field coverage: all writable Fortnox Order API fields exposed
</success_criteria>

<output>
After completion, create `.planning/phases/03-customer-article-and-order-resources/03-02-SUMMARY.md`
</output>
