---
phase: 03-customer-article-and-order-resources
plan: 03
type: execute
wave: 2
depends_on:
  - 03-01
  - 03-02
files_modified:
  - nodes/Fortnox/Fortnox.node.ts
autonomous: true
requirements:
  - CUST-01
  - CUST-02
  - CUST-03
  - CUST-04
  - ART-01
  - ART-02
  - ART-03
  - ART-04
  - ART-05
  - ORD-01
  - ORD-02
  - ORD-03
  - ORD-04
  - ORD-05
  - ORD-06

must_haves:
  truths:
    - "User can select Customer, Article, or Order as a resource in the Fortnox node"
    - "User can create a customer with name and additional fields"
    - "User can get, list, update, and delete customers"
    - "User can create an article with description and additional fields"
    - "User can get, list, update, and delete articles"
    - "User can create an order with customer number and order rows"
    - "User can get, list, update, cancel, and convert orders to invoices"
    - "Delete operations return { success: true } for empty response bodies"
    - "Order createInvoice extracts response from response.Invoice (not response.Order)"
    - "Package builds cleanly with npm run build"
  artifacts:
    - path: "nodes/Fortnox/Fortnox.node.ts"
      provides: "Main node with all 4 resources wired into execute()"
      exports: ["Fortnox"]
  key_links:
    - from: "nodes/Fortnox/Fortnox.node.ts"
      to: "nodes/Fortnox/CustomerDescription.ts"
      via: "import { customerFields, customerOperations }"
      pattern: "import.*customerOperations.*CustomerDescription"
    - from: "nodes/Fortnox/Fortnox.node.ts"
      to: "nodes/Fortnox/ArticleDescription.ts"
      via: "import { articleFields, articleOperations }"
      pattern: "import.*articleOperations.*ArticleDescription"
    - from: "nodes/Fortnox/Fortnox.node.ts"
      to: "nodes/Fortnox/OrderDescription.ts"
      via: "import { orderFields, orderOperations }"
      pattern: "import.*orderOperations.*OrderDescription"
    - from: "nodes/Fortnox/Fortnox.node.ts"
      to: "nodes/Fortnox/GenericFunctions.ts"
      via: "import { fortnoxApiRequest, fortnoxApiRequestAllItems }"
      pattern: "fortnoxApiRequest|fortnoxApiRequestAllItems"
---

<objective>
Wire Customer, Article, and Order resources into Fortnox.node.ts. Expand the resource selector, add imports, and implement execute() branches for all operations across all three resources. Verify the complete package builds cleanly.

Purpose: This is the integration plan that connects the Description files (from Plans 01 and 02) to the main node, making all operations usable in n8n workflows.

Output: Fully functional Fortnox node with 4 resources (Invoice, Customer, Article, Order) and clean build.
</objective>

<execution_context>
@/Users/adamnoren/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adamnoren/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-customer-article-and-order-resources/03-01-SUMMARY.md
@.planning/phases/03-customer-article-and-order-resources/03-02-SUMMARY.md
@nodes/Fortnox/Fortnox.node.ts
@nodes/Fortnox/GenericFunctions.ts

<interfaces>
<!-- From existing Fortnox.node.ts -- the executor adds to this file: -->

From nodes/Fortnox/Fortnox.node.ts:
```typescript
// Existing imports to keep:
import { fortnoxApiRequest, fortnoxApiRequestAllItems } from './GenericFunctions';
import { invoiceFields, invoiceOperations } from './InvoiceDescription';

// New imports to add:
import { customerFields, customerOperations } from './CustomerDescription';
import { articleFields, articleOperations } from './ArticleDescription';
import { orderFields, orderOperations } from './OrderDescription';

// Resource selector -- currently only has Invoice, needs Article, Customer, Order added:
options: [
    { name: 'Article', value: 'article' },
    { name: 'Customer', value: 'customer' },
    { name: 'Invoice', value: 'invoice' },
    { name: 'Order', value: 'order' },
],
default: 'invoice',

// Properties spread -- add new operations and fields:
...articleOperations,
...articleFields,
...customerOperations,
...customerFields,
...invoiceOperations,
...invoiceFields,
...orderOperations,
...orderFields,
```

From nodes/Fortnox/GenericFunctions.ts:
```typescript
// These are the helpers to use -- no changes to this file:
export async function fortnoxApiRequest(
    this: IExecuteFunctions | ILoadOptionsFunctions | IHookFunctions,
    method: IHttpRequestMethods,
    endpoint: string,
    body: IDataObject = {},
    qs: IDataObject = {},
): Promise<IDataObject>;

export async function fortnoxApiRequestAllItems(
    this: IExecuteFunctions | ILoadOptionsFunctions,
    method: IHttpRequestMethods,
    endpoint: string,
    resourceKey: string,
    body: IDataObject = {},
    qs: IDataObject = {},
): Promise<IDataObject[]>;
```

Fortnox API patterns:
- Customer: POST/GET/PUT/DELETE /3/customers, response key: Customer/Customers
- Article: POST/GET/PUT/DELETE /3/articles, response key: Article/Articles
- Order: POST/GET/PUT /3/orders, response key: Order/Orders
- Order cancel: PUT /3/orders/{id}/cancel -> { Order: {...} }
- Order createInvoice: PUT /3/orders/{id}/createinvoice -> { Invoice: {...} } (NOTE: returns Invoice, not Order!)
- DELETE endpoints return empty body -> return { success: true }
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire all three resources into Fortnox.node.ts execute()</name>
  <files>nodes/Fortnox/Fortnox.node.ts</files>
  <action>
Modify `nodes/Fortnox/Fortnox.node.ts` to add Customer, Article, and Order resources.

**1. Add imports** (after existing InvoiceDescription import):
```typescript
import { articleFields, articleOperations } from './ArticleDescription';
import { customerFields, customerOperations } from './CustomerDescription';
import { orderFields, orderOperations } from './OrderDescription';
```

**2. Expand resource selector** -- replace the current options array with all 4 resources alphabetized:
```typescript
options: [
    { name: 'Article', value: 'article' },
    { name: 'Customer', value: 'customer' },
    { name: 'Invoice', value: 'invoice' },
    { name: 'Order', value: 'order' },
],
default: 'invoice',
```

**3. Add operation/field spreads** in properties array (alphabetized by resource):
```typescript
...articleOperations,
...articleFields,
...customerOperations,
...customerFields,
...invoiceOperations,
...invoiceFields,
...orderOperations,
...orderFields,
```

**4. Add Customer execute branches** (after the existing invoice block, before the constructExecutionMetaData call):

```typescript
if (resource === 'customer') {
    if (operation === 'create') {
        const name = this.getNodeParameter('name', i) as string;
        const additionalFields = this.getNodeParameter('additionalFields', i) as IDataObject;
        const body: IDataObject = { Customer: { Name: name } as IDataObject };
        const customerBody = body.Customer as IDataObject;
        for (const key of Object.keys(additionalFields)) {
            if (additionalFields[key] !== '') {
                customerBody[key] = additionalFields[key];
            }
        }
        const response = await fortnoxApiRequest.call(this, 'POST', '/3/customers', body);
        responseData = response.Customer as IDataObject;
    }
    if (operation === 'get') {
        const customerNumber = this.getNodeParameter('customerNumber', i) as string;
        const response = await fortnoxApiRequest.call(this, 'GET', `/3/customers/${customerNumber}`);
        responseData = response.Customer as IDataObject;
    }
    if (operation === 'getMany') {
        const returnAll = this.getNodeParameter('returnAll', i) as boolean;
        const filters = this.getNodeParameter('filters', i) as IDataObject;
        const qs: IDataObject = {};
        for (const key of Object.keys(filters)) {
            if (filters[key] !== '') { qs[key] = filters[key]; }
        }
        if (returnAll) {
            responseData = await fortnoxApiRequestAllItems.call(this, 'GET', '/3/customers', 'Customers', {}, qs);
        } else {
            const limit = this.getNodeParameter('limit', i) as number;
            qs.limit = limit;
            const response = await fortnoxApiRequest.call(this, 'GET', '/3/customers', {}, qs);
            responseData = response.Customers as IDataObject[];
        }
    }
    if (operation === 'update') {
        const customerNumber = this.getNodeParameter('customerNumber', i) as string;
        const updateFields = this.getNodeParameter('updateFields', i) as IDataObject;
        const body: IDataObject = { Customer: {} as IDataObject };
        const customerBody = body.Customer as IDataObject;
        for (const key of Object.keys(updateFields)) {
            if (updateFields[key] !== '') { customerBody[key] = updateFields[key]; }
        }
        const response = await fortnoxApiRequest.call(this, 'PUT', `/3/customers/${customerNumber}`, body);
        responseData = response.Customer as IDataObject;
    }
    if (operation === 'delete') {
        const customerNumber = this.getNodeParameter('customerNumber', i) as string;
        await fortnoxApiRequest.call(this, 'DELETE', `/3/customers/${customerNumber}`);
        responseData = { success: true } as IDataObject;
    }
}
```

**5. Add Article execute branches:**

```typescript
if (resource === 'article') {
    if (operation === 'create') {
        const description = this.getNodeParameter('description', i) as string;
        const additionalFields = this.getNodeParameter('additionalFields', i) as IDataObject;
        const body: IDataObject = { Article: { Description: description } as IDataObject };
        const articleBody = body.Article as IDataObject;
        for (const key of Object.keys(additionalFields)) {
            if (additionalFields[key] !== '') {
                articleBody[key] = additionalFields[key];
            }
        }
        const response = await fortnoxApiRequest.call(this, 'POST', '/3/articles', body);
        responseData = response.Article as IDataObject;
    }
    if (operation === 'get') {
        const articleNumber = this.getNodeParameter('articleNumber', i) as string;
        const response = await fortnoxApiRequest.call(this, 'GET', `/3/articles/${articleNumber}`);
        responseData = response.Article as IDataObject;
    }
    if (operation === 'getMany') {
        const returnAll = this.getNodeParameter('returnAll', i) as boolean;
        const filters = this.getNodeParameter('filters', i) as IDataObject;
        const qs: IDataObject = {};
        for (const key of Object.keys(filters)) {
            if (filters[key] !== '') { qs[key] = filters[key]; }
        }
        if (returnAll) {
            responseData = await fortnoxApiRequestAllItems.call(this, 'GET', '/3/articles', 'Articles', {}, qs);
        } else {
            const limit = this.getNodeParameter('limit', i) as number;
            qs.limit = limit;
            const response = await fortnoxApiRequest.call(this, 'GET', '/3/articles', {}, qs);
            responseData = response.Articles as IDataObject[];
        }
    }
    if (operation === 'update') {
        const articleNumber = this.getNodeParameter('articleNumber', i) as string;
        const updateFields = this.getNodeParameter('updateFields', i) as IDataObject;
        const body: IDataObject = { Article: {} as IDataObject };
        const articleBody = body.Article as IDataObject;
        for (const key of Object.keys(updateFields)) {
            if (updateFields[key] !== '') { articleBody[key] = updateFields[key]; }
        }
        const response = await fortnoxApiRequest.call(this, 'PUT', `/3/articles/${articleNumber}`, body);
        responseData = response.Article as IDataObject;
    }
    if (operation === 'delete') {
        const articleNumber = this.getNodeParameter('articleNumber', i) as string;
        await fortnoxApiRequest.call(this, 'DELETE', `/3/articles/${articleNumber}`);
        responseData = { success: true } as IDataObject;
    }
}
```

**6. Add Order execute branches:**

```typescript
if (resource === 'order') {
    if (operation === 'create') {
        const customerNumber = this.getNodeParameter('customerNumber', i) as string;
        const orderRows = this.getNodeParameter('orderRows', i) as IDataObject;
        const additionalFields = this.getNodeParameter('additionalFields', i) as IDataObject;
        const body: IDataObject = {
            Order: { CustomerNumber: customerNumber } as IDataObject,
        };
        const orderBody = body.Order as IDataObject;
        if (orderRows.row) {
            orderBody.OrderRows = orderRows.row;
        }
        for (const key of Object.keys(additionalFields)) {
            if (additionalFields[key] !== '') {
                orderBody[key] = additionalFields[key];
            }
        }
        const response = await fortnoxApiRequest.call(this, 'POST', '/3/orders', body);
        responseData = response.Order as IDataObject;
    }
    if (operation === 'get') {
        const documentNumber = this.getNodeParameter('documentNumber', i) as string;
        const response = await fortnoxApiRequest.call(this, 'GET', `/3/orders/${documentNumber}`);
        responseData = response.Order as IDataObject;
    }
    if (operation === 'getMany') {
        const returnAll = this.getNodeParameter('returnAll', i) as boolean;
        const filters = this.getNodeParameter('filters', i) as IDataObject;
        const qs: IDataObject = {};
        for (const key of Object.keys(filters)) {
            if (filters[key] !== '') { qs[key] = filters[key]; }
        }
        if (returnAll) {
            responseData = await fortnoxApiRequestAllItems.call(this, 'GET', '/3/orders', 'Orders', {}, qs);
        } else {
            const limit = this.getNodeParameter('limit', i) as number;
            qs.limit = limit;
            const response = await fortnoxApiRequest.call(this, 'GET', '/3/orders', {}, qs);
            responseData = response.Orders as IDataObject[];
        }
    }
    if (operation === 'update') {
        const documentNumber = this.getNodeParameter('documentNumber', i) as string;
        const updateFields = this.getNodeParameter('updateFields', i) as IDataObject;
        const body: IDataObject = { Order: {} as IDataObject };
        const orderBody = body.Order as IDataObject;
        // Handle OrderRows nested fixedCollection
        if (updateFields.OrderRows) {
            const rows = updateFields.OrderRows as IDataObject;
            orderBody.OrderRows = rows.row;
            delete updateFields.OrderRows;
        }
        for (const key of Object.keys(updateFields)) {
            if (updateFields[key] !== '') { orderBody[key] = updateFields[key]; }
        }
        const response = await fortnoxApiRequest.call(this, 'PUT', `/3/orders/${documentNumber}`, body);
        responseData = response.Order as IDataObject;
    }
    if (operation === 'cancel') {
        const documentNumber = this.getNodeParameter('documentNumber', i) as string;
        const response = await fortnoxApiRequest.call(this, 'PUT', `/3/orders/${documentNumber}/cancel`);
        responseData = response.Order as IDataObject;
    }
    if (operation === 'createInvoice') {
        const documentNumber = this.getNodeParameter('documentNumber', i) as string;
        // IMPORTANT: createinvoice returns { Invoice: {...} }, NOT { Order: {...} }
        const response = await fortnoxApiRequest.call(this, 'PUT', `/3/orders/${documentNumber}/createinvoice`);
        responseData = response.Invoice as IDataObject;
    }
}
```

**Key pitfalls to handle correctly:**
- Delete operations (Customer, Article): return `{ success: true }` because Fortnox DELETE returns empty body
- Order createInvoice: extract from `response.Invoice` NOT `response.Order`
- Order cancel: regular `response.Order` extraction
- Order update OrderRows: handle nested fixedCollection same as Invoice update InvoiceRows
- Order create orderRows: extract `.row` from the fixedCollection same as Invoice create
  </action>
  <verify>
    <automated>cd /Users/adamnoren/n8n-nodes-fortnox && npx tsc --noEmit 2>&1 | head -20</automated>
  </verify>
  <done>
    - Fortnox.node.ts imports all three new Description files
    - Resource selector has 4 options: Article, Customer, Invoice, Order (alphabetized)
    - Customer execute: create, get, getMany, update, delete all wired
    - Article execute: create, get, getMany, update, delete all wired
    - Order execute: create, get, getMany, update, cancel, createInvoice all wired
    - Delete operations return { success: true }
    - Order createInvoice extracts response.Invoice
    - TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify full package build and lint</name>
  <files>nodes/Fortnox/Fortnox.node.ts</files>
  <action>
Run the full build pipeline to verify everything compiles and lints cleanly:

1. Run `npm run build` -- must complete without errors
2. Run `npm run lint` -- must complete without errors
3. Verify dist/ output includes the new Description files:
   - dist/nodes/Fortnox/CustomerDescription.js
   - dist/nodes/Fortnox/ArticleDescription.js
   - dist/nodes/Fortnox/OrderDescription.js
4. If lint errors occur, fix them in the relevant files (likely Title Case, alphabetization, or default value issues)

Common lint fixes needed:
- displayName values must be Title Case
- Options within collections must be alphabetized by displayName
- Options type fields must default to a valid option value (not empty string)
- Description fields should not end with a period
  </action>
  <verify>
    <automated>cd /Users/adamnoren/n8n-nodes-fortnox && npm run build 2>&1 | tail -5 && npm run lint 2>&1 | tail -5</automated>
  </verify>
  <done>
    - npm run build succeeds without errors
    - npm run lint succeeds without errors
    - dist/ contains CustomerDescription.js, ArticleDescription.js, OrderDescription.js
    - Complete package is ready for npm publish
  </done>
</task>

</tasks>

<verification>
- `npm run build` completes with exit code 0
- `npm run lint` completes with exit code 0
- `npx tsc --noEmit` compiles all files without errors
- dist/ output includes all new Description files
- Resource selector shows 4 options in alphabetical order
- All 16 operations wired: Customer (5) + Article (5) + Order (6)
</verification>

<success_criteria>
1. Fortnox node has 4 resources: Article, Customer, Invoice, Order
2. All Customer operations work: create (Name required), get, getMany, update, delete
3. All Article operations work: create (Description required), get, getMany, update, delete
4. All Order operations work: create (CustomerNumber + OrderRows), get, getMany, update, cancel, createInvoice
5. Delete returns { success: true }, createInvoice extracts response.Invoice
6. Package builds and lints cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/03-customer-article-and-order-resources/03-03-SUMMARY.md`
</output>
